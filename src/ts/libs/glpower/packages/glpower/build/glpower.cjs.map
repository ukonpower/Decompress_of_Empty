{"version":3,"file":"glpower.cjs","sources":["../src/GLPowerVAO.ts","../src/GLPowerProgram.ts","../src/GLPowerBuffer.ts","../src/Math/Vector.ts","../src/GLPowerTexture.ts","../src/GLPowerFrameBuffer.ts","../src/Power.ts","../src/GLPowerTransformFeedback.ts","../src/Math/Matrix.ts","../src/Math/Quaternion.ts","../src/Geometries/Geometry.ts","../src/Geometries/CubeGeometry.ts","../src/Geometries/CylinderGeometry.ts","../src/Geometries/PlaneGeometry.ts","../src/Geometries/SphereGeometry.ts","../src/Geometries/MipMapGeometry.ts","../src/ECS/index.ts","../src/utils/EventEmitter.ts","../src/ECS/System/index.ts","../src/Animation/Bezier.ts","../src/Animation/Easings.ts","../src/Animation/FCurve.ts","../src/Animation/FCurveGroup.ts","../src/Animation/FCurveKeyFrame.ts","../src/BLidge/index.ts"],"sourcesContent":["import { GLPowerBuffer } from \"./GLPowerBuffer\";\r\n\r\nexport type Attribute = {\r\n\tarray: number[];\r\n\tsize: number;\r\n}\r\n\r\ntype AttributeOptions = {\r\n\tinstanceDivisor?: number;\r\n}\r\n\r\nexport type AttributeBuffer = {\r\n\tbuffer: GLPowerBuffer;\r\n\tsize: number;\r\n\tcount: number;\r\n\tlocation?: number;\r\n} & AttributeOptions\r\n\r\nexport class GLPowerVAO {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\r\n\tpublic vao: WebGLVertexArrayObject | null;\r\n\r\n\tpublic program: WebGLProgram;\r\n\r\n\tprotected indexBuffer: GLPowerBuffer | null;\r\n\r\n\tprotected attributes: Map<string, AttributeBuffer>;\r\n\r\n\tpublic vertCount: number;\r\n\tpublic indexCount: number;\r\n\r\n\tpublic instanceCount: number;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext, program: WebGLProgram ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.program = program;\r\n\r\n\t\tthis.vao = this.gl.createVertexArray();\r\n\t\tthis.attributes = new Map();\r\n\t\tthis.indexBuffer = null;\r\n\r\n\t\tthis.vertCount = 0;\r\n\t\tthis.indexCount = 0;\r\n\t\tthis.instanceCount = 0;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tAttribute\r\n\t-------------------------------*/\r\n\r\n\tpublic setAttribute( name: string, buffer: GLPowerBuffer, size: number, opt?: AttributeOptions ) {\r\n\r\n\t\tconst attr = this.attributes.get( name );\r\n\r\n\t\tconst count = buffer.array ? buffer.array.length / size : 0;\r\n\r\n\t\tthis.attributes.set( name, {\r\n\t\t\t...attr,\r\n\t\t\t...{\r\n\t\t\t\tbuffer,\r\n\t\t\t\tsize,\r\n\t\t\t\tcount,\r\n\t\t\t\t...opt\r\n\t\t\t},\r\n\t\t\tlocation: undefined\r\n\t\t} );\r\n\r\n\t\tthis.updateAttributes();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic removeAttribute( name: string ) {\r\n\r\n\t\tthis.attributes.delete( name );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic updateAttributes( force?: boolean ) {\r\n\r\n\t\tif ( ! this.vao ) return;\r\n\r\n\t\tthis.vertCount = 0;\r\n\t\tthis.instanceCount = 0;\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tthis.attributes.forEach( ( attribute, name ) => {\r\n\r\n\t\t\tif ( ( attribute.location === undefined || force ) ) {\r\n\r\n\t\t\t\tattribute.location = this.gl.getAttribLocation( this.program, name );\r\n\r\n\t\t\t\tif ( attribute.location > - 1 ) {\r\n\r\n\t\t\t\t\tthis.gl.bindBuffer( this.gl.ARRAY_BUFFER, attribute.buffer.buffer );\r\n\t\t\t\t\tthis.gl.enableVertexAttribArray( attribute.location );\r\n\t\t\t\t\tthis.gl.vertexAttribPointer( attribute.location, attribute.size, this.gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t\tif ( attribute.instanceDivisor !== undefined ) {\r\n\r\n\t\t\t\t\t\tthis.gl.vertexAttribDivisor( attribute.location, attribute.instanceDivisor );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.vertCount = Math.max( this.vertCount, attribute.count );\r\n\r\n\t\t\tif ( attribute.instanceDivisor !== undefined && attribute.instanceDivisor > 0 ) {\r\n\r\n\t\t\t\tif ( this.instanceCount == 0 ) {\r\n\r\n\t\t\t\t\tthis.instanceCount = attribute.count;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.instanceCount = Math.min( this.instanceCount, attribute.count );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tIndex\r\n\t-------------------------------*/\r\n\r\n\tpublic setIndex( indexBuffer: GLPowerBuffer | null ) {\r\n\r\n\t\tthis.indexBuffer = indexBuffer;\r\n\r\n\t\tif ( ! this.vao ) return;\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tthis.gl.bindBuffer( this.gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer ? this.indexBuffer.buffer : null );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t\tif ( this.indexBuffer && this.indexBuffer.array ) {\r\n\r\n\t\t\tthis.indexCount = this.indexBuffer.array.length;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tUSE\r\n\t-------------------------------*/\r\n\r\n\tpublic use( cb?: ( vao: GLPowerVAO ) => void ) {\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tif ( cb ) cb( this );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t}\r\n\r\n\tpublic getVAO() {\r\n\r\n\t\treturn this.vao;\r\n\r\n\t}\r\n\r\n}\r\n","import { Matrix } from \"./Math/Matrix\";\r\nimport { Vector } from \"./Math/Vector\";\r\nimport { GLPowerVAO } from \"./GLPowerVAO\";\r\nimport { GLPowerTexture } from \".\";\r\n\r\nexport type Uniformable = boolean | number | Vector | Matrix | GLPowerTexture;\r\n\r\nexport type UniformType =\r\n\t'1f' | '1fv' | '2f' | '2fv' | '3f' | '3fv' | '4f' | '4fv' |\r\n\t'1i' | '1iv' | '2i' | '2iv' | '3i' | '3iv' | '4i' | '4iv' |\r\n\t'Matrix2fv' | 'Matrix3fv' | 'Matrix4fv';\r\n\r\nexport type Uniform = {\r\n\tlocation: WebGLUniformLocation | null;\r\n\tvalue: ( number | boolean )[];\r\n\ttype: string;\r\n\tcache?: ( number | boolean )[];\r\n\tneedsUpdate?: boolean\r\n}\r\n\r\nexport type Uniforms = {[key:string]: {value: Uniformable | Uniformable[], type: UniformType}}\r\n\r\nexport type ShaderOptions = {\r\n\ttransformFeedbackVaryings?: string[]\r\n}\r\n\r\nexport class GLPowerProgram {\r\n\r\n\tpublic gl: WebGL2RenderingContext;\r\n\tpublic program: WebGLProgram | null;\r\n\r\n\tprivate vao: Map<string, GLPowerVAO>;\r\n\tprotected uniforms: Map<string, Uniform>;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.program = this.gl.createProgram();\r\n\r\n\t\tthis.vao = new Map();\r\n\t\tthis.uniforms = new Map();\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tShader\r\n\t-------------------------------*/\r\n\r\n\tpublic setShader( vertexShaderSrc: string, fragmentShaderSrc: string, opt?: ShaderOptions ) {\r\n\r\n\t\tif ( this.program === null ) {\r\n\r\n\t\t\tconsole.warn( 'program is null.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst vs = this.createShader( vertexShaderSrc, this.gl.VERTEX_SHADER );\r\n\t\tconst fs = this.createShader( fragmentShaderSrc, this.gl.FRAGMENT_SHADER );\r\n\r\n\t\tif ( ! vs || ! fs ) return;\r\n\r\n\t\tthis.gl.attachShader( this.program, vs );\r\n\t\tthis.gl.attachShader( this.program, fs );\r\n\r\n\t\tif ( opt && opt.transformFeedbackVaryings ) {\r\n\r\n\t\t\tthis.gl.transformFeedbackVaryings( this.program, opt.transformFeedbackVaryings, this.gl.SEPARATE_ATTRIBS );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.linkProgram( this.program );\r\n\r\n\t\tif ( ! this.gl.getProgramParameter( this.program, this.gl.LINK_STATUS ) ) {\r\n\r\n\t\t\tconsole.error( 'program link error:', this.gl.getProgramInfoLog( this.program ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprotected createShader( shaderSrc: string, type: number ) {\r\n\r\n\t\tconst shader = this.gl.createShader( type );\r\n\r\n\t\tif ( ! shader ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.shaderSource( shader, shaderSrc );\r\n\t\tthis.gl.compileShader( shader );\r\n\r\n\t\tif ( this.gl.getShaderParameter( shader, this.gl.COMPILE_STATUS ) ) {\r\n\r\n\t\t\treturn shader;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( this.gl.getShaderInfoLog( shader ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tUniforms\r\n\t-------------------------------*/\r\n\r\n\tpublic setUniform( name: string, type: UniformType, value: ( number | boolean )[] ) {\r\n\r\n\t\tconst uniform = this.uniforms.get( name );\r\n\r\n\t\tif ( uniform ) {\r\n\r\n\t\t\tuniform.type = type;\r\n\t\t\tuniform.value = value;\r\n\r\n\t\t\tif ( uniform.cache ) {\r\n\r\n\t\t\t\tfor ( let i = 0; i < value.length; i ++ ) {\r\n\r\n\t\t\t\t\tif ( uniform.cache[ i ] !== value[ i ] ) {\r\n\r\n\t\t\t\t\t\tuniform.needsUpdate = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tuniform.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.uniforms.set( name, {\r\n\t\t\t\tvalue,\r\n\t\t\t\ttype: type,\r\n\t\t\t\tlocation: null,\r\n\t\t\t\tneedsUpdate: true\r\n\t\t\t} );\r\n\r\n\t\t\tthis.updateUniformLocations();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate updateUniformLocations( force?: boolean ) {\r\n\r\n\t\tif ( ! this.program ) return;\r\n\r\n\t\tthis.uniforms.forEach( ( uniform, key ) => {\r\n\r\n\t\t\tif ( uniform.location === null || force ) {\r\n\r\n\t\t\t\tuniform.location = this.gl.getUniformLocation( this.program!, key );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic uploadUniforms() {\r\n\r\n\t\tthis.uniforms.forEach( uniform => {\r\n\r\n\t\t\tif ( uniform.needsUpdate ) {\r\n\r\n\t\t\t\tif ( /Matrix[2|3|4]fv/.test( uniform.type ) ) {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, false, uniform.value );\r\n\r\n\t\t\t\t} else if ( /[1|2|3|4][f|i]$/.test( uniform.type ) ) {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, ...uniform.value );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, uniform.value );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuniform.cache = uniform.value.concat();\r\n\t\t\t\tuniform.needsUpdate = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tVAO\r\n\t-------------------------------*/\r\n\r\n\tpublic getVAO( id: string = '_' ) {\r\n\r\n\t\tif ( ! this.program ) return null;\r\n\r\n\t\tlet vao = this.vao.get( id );\r\n\r\n\t\tif ( vao ) return vao;\r\n\r\n\t\tvao = new GLPowerVAO( this.gl, this.program );\r\n\r\n\t\tthis.vao.set( id, vao );\r\n\r\n\t\treturn vao;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tDraw??\r\n\t-------------------------------*/\r\n\r\n\tpublic use( cb?: ( program: GLPowerProgram ) => void ) {\r\n\r\n\t\tif ( ! this.program ) return;\r\n\r\n\t\tthis.gl.useProgram( this.program );\r\n\r\n\t\tif ( cb ) {\r\n\r\n\t\t\tcb( this );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.useProgram( null );\r\n\r\n\t}\r\n\r\n\tpublic getProgram() {\r\n\r\n\t\treturn this.program;\r\n\r\n\t}\r\n\r\n}\r\n","export type BufferType = 'vbo' | 'ibo';\r\nexport type TArrayBuffer = Uint8Array | Uint16Array | Uint32Array | Float32Array | Float64Array\r\n\r\nexport class GLPowerBuffer {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tpublic buffer: WebGLBuffer | null;\r\n\tpublic array: TArrayBuffer | null;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.buffer = this.gl.createBuffer();\r\n\r\n\t\tthis.array = null;\r\n\r\n\t}\r\n\r\n\tpublic setData( data: TArrayBuffer, type: BufferType = 'vbo', usage?: number ) {\r\n\r\n\t\tconst target = type == 'vbo' ? this.gl.ARRAY_BUFFER : this.gl.ELEMENT_ARRAY_BUFFER;\r\n\r\n\t\tthis.gl.bindBuffer( target, this.buffer );\r\n\r\n\t\tthis.gl.bufferData( target, data, usage || this.gl.STATIC_DRAW );\r\n\r\n\t\tthis.gl.bindBuffer( target, null );\r\n\r\n\t\tthis.array = data;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n","import { Matrix, Types } from \"..\";\r\n\r\nexport type IVector2 = {\r\n\tx: number,\r\n\ty: number,\r\n}\r\n\r\nexport type IVector3 = IVector2 & {\r\n\tz: number,\r\n}\r\n\r\nexport type IVector4 = IVector3 & {\r\n\tw: number,\r\n}\r\n\r\nexport class Vector {\r\n\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\tpublic w: number;\r\n\r\n\tconstructor( x?: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = x || 0;\r\n\t\tthis.y = y || 0;\r\n\t\tthis.z = z || 0;\r\n\t\tthis.w = w || 0;\r\n\r\n\t}\r\n\r\n\tpublic get isVector() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic set( x: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y ?? this.y;\r\n\t\tthis.z = z ?? this.z;\r\n\t\tthis.w = w ?? this.w;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic add( a: number ): Vector\r\n\r\n\tpublic add( a: Vector | Types.Nullable<IVector4> ): Vector\r\n\r\n\tpublic add( a: Vector | Types.Nullable<IVector4> | number ): Vector {\r\n\r\n\t\tif ( typeof a == 'number' ) {\r\n\r\n\t\t\tthis.x += a;\r\n\t\t\tthis.y += a;\r\n\t\t\tthis.z += a;\r\n\t\t\tthis.w += a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x += a.x ?? 0;\r\n\t\t\tthis.y += a.y ?? 0;\r\n\t\t\tthis.z += a.z ?? 0;\r\n\t\t\tthis.w += a.w ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic sub( a: number ): Vector\r\n\r\n\tpublic sub( a: Vector | Types.Nullable<IVector4> ): Vector\r\n\r\n\tpublic sub( a: Vector | Types.Nullable<IVector4> | number ) {\r\n\r\n\t\tif ( typeof ( a ) == 'number' ) {\r\n\r\n\t\t\tthis.x -= a;\r\n\t\t\tthis.y -= a;\r\n\t\t\tthis.z -= a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x -= a.x ?? 0;\r\n\t\t\tthis.y -= a.y ?? 0;\r\n\t\t\tthis.z -= a.z ?? 0;\r\n\t\t\tthis.w -= a.w ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic multiply( a: number ): Vector;\r\n\r\n\tpublic multiply( a: Vector ): Vector;\r\n\r\n\tpublic multiply( a: number | Vector ) {\r\n\r\n\t\tif ( typeof a == 'number' ) {\r\n\r\n\t\t\tthis.x *= a;\r\n\t\t\tthis.y *= a;\r\n\t\t\tthis.z *= a;\r\n\t\t\tthis.w *= a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x *= a.x;\r\n\t\t\tthis.y *= a.y;\r\n\t\t\tthis.z *= a.z;\r\n\t\t\tthis.w *= a.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic divide( a: number ): Vector;\r\n\r\n\tpublic divide( a: Vector ): Vector;\r\n\r\n\tpublic divide( a: number | Vector ) {\r\n\r\n\t\tif ( typeof a == 'number' ) {\r\n\r\n\t\t\tthis.x /= a;\r\n\t\t\tthis.y /= a;\r\n\t\t\tthis.z /= a;\r\n\t\t\tthis.w /= a;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.x /= a.x;\r\n\t\t\tthis.y /= a.y;\r\n\t\t\tthis.z /= a.z;\r\n\t\t\tthis.w /= a.w;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic length() {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w );\r\n\r\n\t}\r\n\r\n\tpublic normalize() {\r\n\r\n\t\treturn this.divide( this.length() || 1 );\r\n\r\n\t}\r\n\r\n\tpublic cross( v: Vector | IVector3 ) {\r\n\r\n\t\tconst ax = this.x, ay = this.y, az = this.z;\r\n\t\tconst bx = v.x, by = v.y, bz = v.z;\r\n\r\n\t\tthis.x = ay * bz - az * by;\r\n\t\tthis.y = az * bx - ax * bz;\r\n\t\tthis.z = ax * by - ay * bx;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic dot( v: Vector | IVector3 ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n\t}\r\n\r\n\tpublic applyMatrix3( mat: Matrix ) {\r\n\r\n\t\tconst elm = mat.elm;\r\n\r\n\t\tconst e11 = elm[ 0 ], e12 = elm[ 1 ], e13 = elm[ 2 ],\r\n\t\t\te21 = elm[ 4 ], e22 = elm[ 5 ], e23 = elm[ 6 ],\r\n\t\t\te31 = elm[ 8 ], e32 = elm[ 9 ], e33 = elm[ 10 ];\r\n\r\n\t\t// const xx = this.x * e11 + this.y * e12 + this.z * e13;\r\n\t\t// const yy = this.x * e21 + this.y * e22 + this.z * e23;\r\n\t\t// const zz = this.x * e31 + this.y * e32 + this.z * e33;\r\n\r\n\t\tconst xx = this.x * e11 + this.y * e21 + this.z * e31;\r\n\t\tconst yy = this.x * e12 + this.y * e22 + this.z * e32;\r\n\t\tconst zz = this.x * e13 + this.y * e23 + this.z * e33;\r\n\r\n\t\tthis.x = xx;\r\n\t\tthis.y = yy;\r\n\t\tthis.z = zz;\r\n\t\tthis.w = 0;\r\n\r\n\t}\r\n\r\n\tpublic applyMatrix4( mat: Matrix ) {\r\n\r\n\t\tconst elm = mat.elm;\r\n\r\n\t\tconst e11 = elm[ 0 ], e12 = elm[ 1 ], e13 = elm[ 2 ], e14 = elm[ 3 ],\r\n\t\t\te21 = elm[ 4 ], e22 = elm[ 5 ], e23 = elm[ 6 ], e24 = elm[ 7 ],\r\n\t\t\te31 = elm[ 8 ], e32 = elm[ 9 ], e33 = elm[ 10 ], e34 = elm[ 11 ],\r\n\t\t\te41 = elm[ 12 ], e42 = elm[ 13 ], e43 = elm[ 14 ], e44 = elm[ 15 ];\r\n\r\n\t\tconst xx = this.x * e11 + this.y * e21 + this.z * e31 + this.w * e41;\r\n\t\tconst yy = this.x * e12 + this.y * e22 + this.z * e32 + this.w * e42;\r\n\t\tconst zz = this.x * e13 + this.y * e23 + this.z * e33 + this.w * e43;\r\n\t\tconst ww = this.x * e14 + this.y * e24 + this.z * e34 + this.w * e44;\r\n\r\n\t\tthis.x = xx;\r\n\t\tthis.y = yy;\r\n\t\tthis.z = zz;\r\n\t\tthis.w = ww;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic copy( a: Vector | Types.Nullable<IVector4> ) {\r\n\r\n\t\tthis.x = a.x ?? 0;\r\n\t\tthis.y = a.y ?? 0;\r\n\t\tthis.z = a.z ?? 0;\r\n\t\tthis.w = a.w ?? 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Vector( this.x, this.y, this.z, this.w );\r\n\r\n\t}\r\n\r\n\tpublic getElm( type?: 'vec2' | 'vec3' | 'vec4' ) {\r\n\r\n\t\tif ( type == 'vec2' ) {\r\n\r\n\t\t\treturn [ this.x, this.y ];\r\n\r\n\t\t} else if ( type == 'vec3' ) {\r\n\r\n\t\t\treturn [ this.x, this.y, this.z ];\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn [ this.x, this.y, this.z, this.w ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { Vector } from \"./Math/Vector\";\r\nimport { Types } from \"./types\";\r\n\r\ntype ImagePretense = {\r\n\twidth: number,\r\n\theight: number\r\n}\r\n\r\ntype GLPowerTextureSetting = {\r\n\ttype: number,\r\n\tinternalFormat: number,\r\n\tformat: number,\r\n\tmagFilter: number,\r\n\tminFilter: number,\r\n\tgenerateMipmap: boolean,\r\n\twrapS: number,\r\n\twrapT: number,\r\n}\r\n\r\nexport class GLPowerTexture {\r\n\r\n\tpublic unit: number;\r\n\tpublic image: HTMLImageElement | ImagePretense | null;\r\n\tpublic size: Vector;\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tprivate texture: WebGLTexture | null;\r\n\r\n\tprivate _setting: GLPowerTextureSetting;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\t\tthis.image = null;\r\n\t\tthis.unit = 0;\r\n\t\tthis.size = new Vector();\r\n\t\tthis.texture = this.gl.createTexture();\r\n\r\n\t\tthis._setting = {\r\n\t\t\ttype: this.gl.UNSIGNED_BYTE,\r\n\t\t\tinternalFormat: this.gl.RGBA,\r\n\t\t\tformat: this.gl.RGBA,\r\n\t\t\tmagFilter: this.gl.NEAREST,\r\n\t\t\tminFilter: this.gl.NEAREST,\r\n\t\t\tgenerateMipmap: false,\r\n\t\t\twrapS: this.gl.CLAMP_TO_EDGE,\r\n\t\t\twrapT: this.gl.CLAMP_TO_EDGE,\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic get isTexture() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic setting( param: Types.Nullable<GLPowerTextureSetting> ) {\r\n\r\n\t\tthis._setting = {\r\n\t\t\t...this._setting,\r\n\t\t\t...param\r\n\t\t};\r\n\r\n\t\tthis.attach( this.image );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic attach( img: HTMLImageElement | ImagePretense | null ) {\r\n\r\n\t\tthis.image = img;\r\n\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, this.texture );\r\n\r\n\t\tif ( this.image ) {\r\n\r\n\t\t\tthis.size.set( this.image.width, this.image.height );\r\n\r\n\t\t\tif ( this.image instanceof HTMLImageElement ) {\r\n\r\n\t\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this._setting.internalFormat, this._setting.format, this._setting.type, this.image );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this._setting.internalFormat, this.image.width, this.image.height, 0, this._setting.format, this._setting.type, null );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.size.set( 1, 1 );\r\n\r\n\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this._setting.internalFormat, this.size.x, this.size.y, 0, this._setting.format, this._setting.type, null );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this._setting.magFilter );\r\n\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this._setting.minFilter );\r\n\t\tthis.gl.texParameterf( this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this._setting.wrapS );\r\n\t\tthis.gl.texParameterf( this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this._setting.wrapT );\r\n\r\n\t\tif ( this._setting.generateMipmap ) {\r\n\r\n\t\t\tthis.gl.generateMipmap( this.gl.TEXTURE_2D );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, null );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic activate( unitNumber: number ) {\r\n\r\n\t\tthis.gl.activeTexture( this.gl.TEXTURE0 + unitNumber );\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, this.texture );\r\n\r\n\t\tthis.unit = unitNumber;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic load( src: string, callBack?: () => void ) {\r\n\r\n\t\tconst img = new Image();\r\n\r\n\t\timg.onload = () => {\r\n\r\n\t\t\tthis.attach( img );\r\n\r\n\t\t\tif ( callBack ) callBack();\r\n\r\n\t\t};\r\n\r\n\t\timg.src = src;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic getTexture() {\r\n\r\n\t\treturn this.texture;\r\n\r\n\t}\r\n\r\n\tpublic loadAsync( src: string ) {\r\n\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\tconst img = new Image();\r\n\r\n\t\t\timg.onload = () => {\r\n\r\n\t\t\t\tthis.attach( img );\r\n\r\n\t\t\t\tresolve( this );\r\n\r\n\t\t\t};\r\n\r\n\t\t\timg.onerror = () => {\r\n\r\n\t\t\t\treject( 'img error, ' + src );\r\n\r\n\t\t\t};\r\n\r\n\t\t\timg.src = src;\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n","import { GLPowerTexture } from \"./GLPowerTexture\";\r\nimport { Vector } from \"./Math/Vector\";\r\n\r\nexport class GLPowerFrameBuffer {\r\n\r\n\tpublic size: Vector;\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tprivate frameBuffer: WebGLFramebuffer | null;\r\n\tprivate depthRenderBuffer: WebGLRenderbuffer | null;\r\n\r\n\tpublic textures: GLPowerTexture[];\r\n\tpublic textureAttachmentList: number[];\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.size = new Vector( 1, 1 );\r\n\r\n\t\tthis.frameBuffer = this.gl.createFramebuffer();\r\n\t\tthis.depthRenderBuffer = this.gl.createRenderbuffer();\r\n\r\n\t\tthis.textures = [];\r\n\t\tthis.textureAttachmentList = [];\r\n\r\n\t\t// depth buffer\r\n\r\n\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, this.depthRenderBuffer );\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, this.frameBuffer );\r\n\t\tthis.gl.framebufferRenderbuffer( this.gl.FRAMEBUFFER, this.gl.DEPTH_ATTACHMENT, this.gl.RENDERBUFFER, this.depthRenderBuffer );\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, null );\r\n\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, null );\r\n\r\n\t}\r\n\r\n\tpublic setTexture( textures: GLPowerTexture[] ) {\r\n\r\n\t\tthis.textures = textures;\r\n\t\tthis.textureAttachmentList.length = 0;\r\n\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, this.frameBuffer );\r\n\r\n\t\tthis.textures.forEach( ( t, i ) => {\r\n\r\n\t\t\tt.attach( { width: this.size.x, height: this.size.y } );\r\n\r\n\t\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, t.getTexture() );\r\n\t\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR );\r\n\t\t\tthis.gl.texParameteri( this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR );\r\n\t\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, null );\r\n\r\n\t\t\tconst attachment = this.gl.COLOR_ATTACHMENT0 + i;\r\n\t\t\tthis.gl.framebufferTexture2D( this.gl.FRAMEBUFFER, attachment, this.gl.TEXTURE_2D, t.getTexture(), 0 );\r\n\r\n\t\t\tthis.textureAttachmentList.push( attachment );\r\n\r\n\t\t} );\r\n\r\n\t\tthis.gl.bindFramebuffer( this.gl.FRAMEBUFFER, null );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic setSize( size: Vector ): void\r\n\r\n\tpublic setSize( width: number, height: number ) : void\r\n\r\n\tpublic setSize( width_size: number | Vector, height?: number ) {\r\n\r\n\t\tif ( typeof width_size == 'number' ) {\r\n\r\n\t\t\tthis.size.x = width_size;\r\n\r\n\t\t\tif ( height !== undefined ) {\r\n\r\n\t\t\t\tthis.size.y = height;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.size.copy( width_size );\r\n\r\n\t\t}\r\n\r\n\t\tthis.setTexture( this.textures );\r\n\r\n\t\tthis.textures.forEach( t => {\r\n\r\n\t\t\tt.attach( { width: this.size.x, height: this.size.y } );\r\n\r\n\t\t} );\r\n\r\n\t\tif ( this.depthRenderBuffer ) {\r\n\r\n\t\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, this.depthRenderBuffer );\r\n\t\t\tthis.gl.renderbufferStorage( this.gl.RENDERBUFFER, this.gl.DEPTH_COMPONENT32F, this.size.x, this.size.y );\r\n\t\t\tthis.gl.bindRenderbuffer( this.gl.RENDERBUFFER, null );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic getFrameBuffer() {\r\n\r\n\t\treturn this.frameBuffer;\r\n\r\n\t}\r\n\r\n}\r\n","import { GLPowerProgram } from \"./GLPowerProgram\";\r\nimport { GLPowerBuffer } from \"./GLPowerBuffer\";\r\nimport { GLPowerTexture } from \"./GLPowerTexture\";\r\nimport { GLPowerFrameBuffer } from \"./GLPowerFrameBuffer\";\r\n\r\nexport class Power {\r\n\r\n\tpublic gl: WebGL2RenderingContext;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.gl.pixelStorei( gl.UNPACK_FLIP_Y_WEBGL, true );\r\n\r\n\t\tthis.gl.getExtension( \"EXT_color_buffer_float\" );\r\n\t\tthis.gl.getExtension( \"EXT_color_buffer_half_float\" );\r\n\r\n\t}\r\n\r\n\tpublic createProgram() {\r\n\r\n\t\tconst program = new GLPowerProgram( this.gl );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\tpublic createBuffer() {\r\n\r\n\t\tconst vertexBuffer = new GLPowerBuffer( this.gl );\r\n\r\n\t\treturn vertexBuffer;\r\n\r\n\t}\r\n\r\n\tpublic createTexture() {\r\n\r\n\t\tconst texture = new GLPowerTexture( this.gl );\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n\tpublic createFrameBuffer() {\r\n\r\n\t\tconst frameBuffer = new GLPowerFrameBuffer( this.gl );\r\n\r\n\t\treturn frameBuffer;\r\n\r\n\t}\r\n\r\n}\r\n\r\n","import { GLPowerBuffer } from \"./GLPowerBuffer\";\r\n\r\nexport class GLPowerTransformFeedback {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tprivate transformFeedback: WebGLTransformFeedback | null;\r\n\r\n\tprotected feedbackBuffer: Map<string, {buffer: GLPowerBuffer, varyingIndex: number}>;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\t\tthis.transformFeedback = this.gl.createTransformFeedback();\r\n\r\n\t\tthis.feedbackBuffer = new Map();\r\n\r\n\t}\r\n\r\n\tpublic bind( cb?: () => void ) {\r\n\r\n\t\tthis.gl.bindTransformFeedback( this.gl.TRANSFORM_FEEDBACK, this.transformFeedback );\r\n\r\n\t\tif ( cb ) cb();\r\n\r\n\t\tthis.gl.bindTransformFeedback( this.gl.TRANSFORM_FEEDBACK, null );\r\n\r\n\t}\r\n\r\n\tpublic setBuffer( name: string, buffer: GLPowerBuffer, varyingIndex: number ) {\r\n\r\n\t\tthis.feedbackBuffer.set( name, {\r\n\t\t\tbuffer,\r\n\t\t\tvaryingIndex\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic use( cb?: ( tf: GLPowerTransformFeedback ) => void ) {\r\n\r\n\t\tthis.bind( () => {\r\n\r\n\t\t\tthis.feedbackBuffer.forEach( fbBuffer => {\r\n\r\n\t\t\t\tthis.gl.bindBufferBase( this.gl.TRANSFORM_FEEDBACK_BUFFER, fbBuffer.varyingIndex, fbBuffer.buffer.buffer );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tif ( cb ) cb( this );\r\n\r\n\t\t\tthis.feedbackBuffer.forEach( fbBuffer => {\r\n\r\n\t\t\t\tthis.gl.bindBufferBase( this.gl.TRANSFORM_FEEDBACK_BUFFER, fbBuffer.varyingIndex, null );\r\n\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n}\r\n","import { IVector4 } from \"..\";\r\nimport { Quaternion } from \"./Quaternion\";\r\nimport { IVector3, Vector } from \"./Vector\";\r\n\r\nexport class Matrix {\r\n\r\n\tpublic elm: number[];\r\n\r\n\tconstructor( elm?: number [] ) {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1,\r\n\t\t];\r\n\r\n\t\tif ( elm ) {\r\n\r\n\t\t\tthis.set( elm );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic identity() {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Matrix().copy( this );\r\n\r\n\t}\r\n\r\n\tpublic copy( mat: Matrix ) {\r\n\r\n\t\tthis.set( mat.elm );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic perspective( fov: number, aspect: number, near: number, far: number ) {\r\n\r\n\t\tvar r = 1 / Math.tan( fov * Math.PI / 360 );\r\n\t\tvar d = far - near;\r\n\r\n\t\tthis.elm = [\r\n\t\t\tr / aspect, 0, 0, 0,\r\n\t\t\t0, r, 0, 0,\r\n\t\t\t0, 0, - ( far + near ) / d, - 1,\r\n\t\t\t0, 0, - ( far * near * 2 ) / d, 0\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic orthographic( width: number, height: number, near: number, far: number ) {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t2 / width, 0, 0, 0,\r\n\t\t\t0, 2 / height, 0, 0,\r\n\t\t\t0, 0, - 2 / ( far - near ), 0,\r\n\t\t\t0, 0, - ( far + near ) / ( far - near ), 1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic lookAt( eye: Vector, target: Vector, up: Vector ) {\r\n\r\n\t\tconst zAxis = eye.clone().sub( target ).normalize();\r\n\t\tconst xAxis = up.clone().cross( zAxis ).normalize();\r\n\t\tconst yAxis = zAxis.clone().cross( xAxis ).normalize();\r\n\r\n\t\tthis.elm = [\r\n\t\t   xAxis.x, yAxis.x, zAxis.x, 0,\r\n\t\t   xAxis.y, yAxis.y, zAxis.y, 0,\r\n\t\t   xAxis.z, yAxis.z, zAxis.z, 0,\r\n\t\t   - eye.dot( xAxis ),\r\n\t\t   - eye.dot( yAxis ),\r\n\t\t   - eye.dot( zAxis ),\r\n\t\t   1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic inverse() {\r\n\r\n\t\tconst a = this.elm[ 0 ], b = this.elm[ 1 ], c = this.elm[ 2 ], d = this.elm[ 3 ],\r\n\t\t\te = this.elm[ 4 ], f = this.elm[ 5 ], g = this.elm[ 6 ], h = this.elm[ 7 ],\r\n\t\t\ti = this.elm[ 8 ], j = this.elm[ 9 ], k = this.elm[ 10 ], l = this.elm[ 11 ],\r\n\t\t\tm = this.elm[ 12 ], n = this.elm[ 13 ], o = this.elm[ 14 ], p = this.elm[ 15 ],\r\n\t\t\tq = a * f - b * e, r = a * g - c * e,\r\n\t\t\ts = a * h - d * e, t = b * g - c * f,\r\n\t\t\tu = b * h - d * f, v = c * h - d * g,\r\n\t\t\tw = i * n - j * m, x = i * o - k * m,\r\n\t\t\ty = i * p - l * m, z = j * o - k * n,\r\n\t\t\tA = j * p - l * n, B = k * p - l * o,\r\n\t\t\tdet = ( q * B - r * A + s * z + t * y - u * x + v * w ),\r\n\t\t\tivd = 1 / det;\r\n\r\n\t\tif ( det == 0 ) return this.identity();\r\n\r\n\t\tthis.elm[ 0 ] = ( f * B - g * A + h * z ) * ivd;\r\n\t\tthis.elm[ 1 ] = ( - b * B + c * A - d * z ) * ivd;\r\n\t\tthis.elm[ 2 ] = ( n * v - o * u + p * t ) * ivd;\r\n\t\tthis.elm[ 3 ] = ( - j * v + k * u - l * t ) * ivd;\r\n\t\tthis.elm[ 4 ] = ( - e * B + g * y - h * x ) * ivd;\r\n\t\tthis.elm[ 5 ] = ( a * B - c * y + d * x ) * ivd;\r\n\t\tthis.elm[ 6 ] = ( - m * v + o * s - p * r ) * ivd;\r\n\t\tthis.elm[ 7 ] = ( i * v - k * s + l * r ) * ivd;\r\n\t\tthis.elm[ 8 ] = ( e * A - f * y + h * w ) * ivd;\r\n\t\tthis.elm[ 9 ] = ( - a * A + b * y - d * w ) * ivd;\r\n\t\tthis.elm[ 10 ] = ( m * u - n * s + p * q ) * ivd;\r\n\t\tthis.elm[ 11 ] = ( - i * u + j * s - l * q ) * ivd;\r\n\t\tthis.elm[ 12 ] = ( - e * z + f * x - g * w ) * ivd;\r\n\t\tthis.elm[ 13 ] = ( a * z - b * x + c * w ) * ivd;\r\n\t\tthis.elm[ 14 ] = ( - m * t + n * r - o * q ) * ivd;\r\n\t\tthis.elm[ 15 ] = ( i * t - j * r + k * q ) * ivd;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic transpose() {\r\n\r\n\t\tconst e11 = this.elm[ 0 ], e12 = this.elm[ 1 ], e13 = this.elm[ 2 ], e14 = this.elm[ 3 ],\r\n\t\t\te21 = this.elm[ 4 ], e22 = this.elm[ 5 ], e23 = this.elm[ 6 ], e24 = this.elm[ 7 ],\r\n\t\t\te31 = this.elm[ 8 ], e32 = this.elm[ 9 ], e33 = this.elm[ 10 ], e34 = this.elm[ 11 ],\r\n\t\t\te41 = this.elm[ 12 ], e42 = this.elm[ 13 ], e43 = this.elm[ 14 ], e44 = this.elm[ 15 ];\r\n\r\n\t\tthis.elm[ 0 ] = e11; this.elm[ 1 ] = e21; this.elm[ 2 ] = e31; this.elm[ 3 ] = e41;\r\n\t\tthis.elm[ 4 ] = e12; this.elm[ 5 ] = e22; this.elm[ 6 ] = e32; this.elm[ 7 ] = e42;\r\n\t\tthis.elm[ 8 ] = e13; this.elm[ 9 ] = e23; this.elm[ 10 ] = e33; this.elm[ 11 ] = e43;\r\n\t\tthis.elm[ 12 ] = e14; this.elm[ 13 ] = e24; this.elm[ 14 ] = e34; this.elm[ 15 ] = e44;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic set( elm: number[] ) {\r\n\r\n\t\tfor ( let i = 0; i < this.elm.length; i ++ ) {\r\n\r\n\t\t\tthis.elm[ i ] = elm[ i ] ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic setFromTransform( pos: IVector3, qua: Quaternion | IVector4, scale: IVector3 ) {\r\n\r\n\t\tthis.identity();\r\n\r\n\t\tthis.applyPosition( pos );\r\n\r\n\t\tthis.applyQuaternion( qua );\r\n\r\n\t\tthis.applyScale( scale );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyPosition( position: IVector3 ) {\r\n\r\n\t\tthis.matmul( [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\tposition.x, position.y, position.z, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyQuaternion( q: Quaternion | IVector4 ) {\r\n\r\n\t\tconst x = q.x, y = q.y, z = q.z, w = q.w;\r\n\t\tconst xx = x * x, yy = y * y, zz = z * z, ww = w * w;\r\n\t\tconst xy = x * y, xz = x * z, xw = x * w, yz = y * z, yw = y * w, zw = z * w;\r\n\r\n\t\tthis.matmul( [\r\n\t\t\txx - yy - zz + ww,\r\n\t\t\t2 * ( xy + zw ),\r\n\t\t\t2 * ( xz - yw ),\r\n\t\t\t0,\r\n\r\n\t\t\t2 * ( xy - zw ),\r\n\t\t\t- xx + yy - zz + ww,\r\n\t\t\t2 * ( yz + xw ),\r\n\t\t\t0,\r\n\r\n\t\t\t2 * ( xz + yw ),\r\n\t\t\t2 * ( yz - xw ),\r\n\t\t\t- xx - yy + zz + ww,\r\n\r\n\t\t\t0, 0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyScale( scale: IVector3 ) {\r\n\r\n\t\tthis.matmul( [\r\n\t\t\tscale.x, 0, 0, 0,\r\n\t\t\t0, scale.y, 0, 0,\r\n\t\t\t0, 0, scale.z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprotected matmul( elm2: number[] ) {\r\n\r\n\t\tconst dist = new Array( 16 );\r\n\r\n\t\tfor ( let i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\r\n\r\n\t\t\t\tlet sum = 0;\r\n\r\n\t\t\t\tfor ( let k = 0; k < 4; k ++ ) {\r\n\r\n\t\t\t\t\tsum += this.elm[ k * 4 + j ] * elm2[ k + i * 4 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist[ j + i * 4 ] = sum;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.elm = dist;\r\n\r\n\t}\r\n\r\n\tpublic multiply( m: Matrix ) {\r\n\r\n\t\tthis.matmul( m.elm );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic preMultiply( m: Matrix ) {\r\n\r\n\t\tconst tmp = this.copyToArray( [] );\r\n\r\n\t\tthis.set( m.elm );\r\n\r\n\t\tthis.matmul( tmp );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic copyToArray( array: number[] ) {\r\n\r\n\t\tarray.length = this.elm.length;\r\n\r\n\t\tfor ( let i = 0; i < this.elm.length; i ++ ) {\r\n\r\n\t\t\tarray[ i ] = this.elm[ i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n}\r\n","import { IVector3 } from \"..\";\r\nimport { Vector } from \"./Vector\";\r\n\r\nexport type Quat = {\r\n\tx: number,\r\n\ty: number,\r\n\tz: number\r\n}\r\n\r\nexport type EulerOrder = 'XYZ' | 'XZY' | 'ZYX' | 'YZX'\r\n\r\nexport class Quaternion {\r\n\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\tpublic w: number;\r\n\r\n\tconstructor( x?: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.z = 0;\r\n\t\tthis.w = 1;\r\n\r\n\t\tthis.set( x, y, z, w );\r\n\r\n\t}\r\n\r\n\tpublic set( x?: number, y?: number, z?: number, w?: number ) {\r\n\r\n\t\tthis.x = x ?? this.x;\r\n\t\tthis.y = y ?? this.y;\r\n\t\tthis.z = z ?? this.z;\r\n\t\tthis.w = w ?? this.w;\r\n\r\n\t}\r\n\r\n\tpublic euler( euler: Vector | IVector3, order: EulerOrder = 'XYZ' ) {\r\n\r\n\t\tconst sx = Math.sin( euler.x / 2 );\r\n\t\tconst sy = Math.sin( euler.y / 2 );\r\n\t\tconst sz = Math.sin( euler.z / 2 );\r\n\r\n\t\tconst cx = Math.cos( euler.x / 2 );\r\n\t\tconst cy = Math.cos( euler.y / 2 );\r\n\t\tconst cz = Math.cos( euler.z / 2 );\r\n\r\n\t\tif ( order == 'XYZ' ) {\r\n\r\n\t\t\tthis.x = cx * sy * sz + sx * cy * cz;\r\n\t\t\tthis.y = - sx * cy * sz + cx * sy * cz;\r\n\t\t\tthis.z = cx * cy * sz + sx * sy * cz;\r\n\t\t\tthis.w = - sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t} else if ( order == 'XZY' ) {\r\n\r\n\t\t\tthis.x = - cx * sy * sz + sx * cy * cz;\r\n\t\t\tthis.y = cx * sy * cz - sx * cy * sz;\r\n\t\t\tthis.z = sx * sy * cz + cx * cy * sz;\r\n\t\t\tthis.w = sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t} else if ( order == 'YZX' ) {\r\n\r\n\t\t\tthis.x = sx * cy * cz + cx * sy * sz;\r\n\t\t\tthis.y = sx * cy * sz + cx * sy * cz;\r\n\t\t\tthis.z = - sx * sy * cz + cx * cy * sz;\r\n\t\t\tthis.w = - sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t} else if ( order == 'ZYX' ) {\r\n\r\n\t\t\tthis.x = sx * cy * cz - cx * sy * sz;\r\n\t\t\tthis.y = sx * cy * sz + cx * sy * cz;\r\n\t\t\tthis.z = - sx * sy * cz + cx * cy * sz;\r\n\t\t\tthis.w = sx * sy * sz + cx * cy * cz;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic multiply() {\r\n\t}\r\n\r\n}\r\n","import { BufferType } from \"../GLPowerBuffer\";\r\nimport { Power } from \"../Power\";\r\nimport { Attribute, AttributeBuffer } from \"../GLPowerVAO\";\r\n\r\ntype DefaultAttributeName = 'position' | 'uv' | 'normal' | 'index';\r\n\r\nexport class Geometry {\r\n\r\n\tpublic count: number = 0;\r\n\r\n\tpublic attributes: {[key: string]: Attribute} = {};\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n\tpublic setAttribute( name: DefaultAttributeName | ( string & {} ), array: number[], size: number ) {\r\n\r\n\t\tthis.attributes[ name ] = {\r\n\t\t\tarray,\r\n\t\t\tsize\r\n\t\t};\r\n\r\n\t\tthis.updateVertCount();\r\n\r\n\t}\r\n\r\n\tpublic getAttribute( name: DefaultAttributeName | ( string & {} ) ) {\r\n\r\n\t\treturn this.attributes[ name ];\r\n\r\n\t}\r\n\r\n\tprivate updateVertCount() {\r\n\r\n\t\tconst keys = Object.keys( this.attributes );\r\n\r\n\t\tthis.count = keys.length > 0 ? Infinity : 0;\r\n\r\n\t\tkeys.forEach( name => {\r\n\r\n\t\t\tconst attribute = this.attributes[ name ];\r\n\r\n\t\t\tif ( name != 'index' ) {\r\n\r\n\t\t\t\tthis.count = Math.min( attribute.array.length / attribute.size, this.count );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// ecs\r\n\r\n\tpublic getAttributeBuffer( core: Power, name: DefaultAttributeName | ( string & {} ), constructor: Float32ArrayConstructor | Uint16ArrayConstructor, bufferType: BufferType = 'vbo' ): AttributeBuffer {\r\n\r\n\t\tconst attr = this.getAttribute( name );\r\n\r\n\t\treturn {\r\n\t\t\tbuffer: core.createBuffer().setData( new constructor( attr.array ), bufferType ),\r\n\t\t\tsize: attr.size,\r\n\t\t\tcount: attr.array.length / attr.size\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic getComponent( power: Power ) {\r\n\r\n\t\tconst attributes = [];\r\n\r\n\t\tif ( this.getAttribute( 'position' ) ) {\r\n\r\n\t\t\tattributes.push( { name: 'position', ...this.getAttributeBuffer( power, 'position', Float32Array ) } );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.getAttribute( 'uv' ) ) {\r\n\r\n\t\t\tattributes.push( { name: 'uv', ...this.getAttributeBuffer( power, 'uv', Float32Array ) } );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.getAttribute( 'normal' ) ) {\r\n\r\n\t\t\tattributes.push( { name: 'normal', ...this.getAttributeBuffer( power, 'normal', Float32Array ) } );\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tattributes,\r\n\t\t\tindex: this.getAttributeBuffer( power, 'index', Uint16Array, 'ibo' )\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\n\r\nexport class CubeGeometry extends Geometry {\r\n\r\n\tconstructor( width: number = 1, height: number = 1, depth: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst hx = width / 2;\r\n\t\tconst hy = height / 2;\r\n\t\tconst hz = depth / 2;\r\n\r\n\t\tconst posArray = [\r\n\t\t\t- hx, hy, hz,\r\n\t\t\thx, hy, hz,\r\n\t\t\t- hx, - hy, hz,\r\n\t\t\thx, - hy, hz,\r\n\r\n\t\t\thx, hy, - hz,\r\n\t\t\t- hx, hy, - hz,\r\n\t\t\thx, - hy, - hz,\r\n\t\t\t- hx, - hy, - hz,\r\n\r\n\t\t\thx, hy, hz,\r\n\t\t\thx, hy, - hz,\r\n\t\t\thx, - hy, hz,\r\n\t\t\thx, - hy, - hz,\r\n\r\n\t\t\t- hx, hy, - hz,\r\n\t\t\t- hx, hy, hz,\r\n\t\t\t- hx, - hy, - hz,\r\n\t\t\t- hx, - hy, hz,\r\n\r\n\t\t\t- hx, hy, - hz,\r\n\t\t\thx, hy, - hz,\r\n\t\t\t- hx, hy, hz,\r\n\t\t\thx, hy, hz,\r\n\r\n\t\t\t- hx, - hy, hz,\r\n\t\t\thx, - hy, hz,\r\n\t\t\t- hx, - hy, - hz,\r\n\t\t\thx, - hy, - hz,\r\n\r\n\t\t];\r\n\r\n\t\tconst normalArray = [\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t];\r\n\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tuvArray.push(\r\n\t\t\t\t0, 1,\r\n\t\t\t\t1, 1,\r\n\t\t\t\t0, 0,\r\n\t\t\t\t1, 0\r\n\t\t\t);\r\n\r\n\t\t\tconst offset = 4 * i;\r\n\r\n\t\t\tindexArray.push(\r\n\t\t\t\t0 + offset, 2 + offset, 1 + offset, 1 + offset, 2 + offset, 3 + offset\r\n\t\t\t);\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector } from '../Math/Vector';\r\n\r\nexport class CylinderGeometry extends Geometry {\r\n\r\n\tconstructor( radiusTop: number = 0.5, radiusBottom: number = 0.5, height: number = 1, radSegments: number = 10, heightSegments: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\t//上下面分2回多くループ\r\n\t\tfor ( let i = 0; i <= heightSegments + 2; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j < radSegments; j ++ ) {\r\n\r\n\t\t\t\tconst theta = Math.PI * 2.0 / radSegments * j;\r\n\r\n\t\t\t\tif ( i <= heightSegments ) {\r\n\r\n\t\t\t\t\t//side\r\n\t\t\t\t\tconst w = i / heightSegments;\r\n\t\t\t\t\tconst radius = ( 1.0 - w ) * radiusBottom + w * radiusTop;\r\n\r\n\t\t\t\t\tconst x = Math.cos( theta ) * radius;\r\n\t\t\t\t\tconst y = - ( height / 2 ) + ( height / heightSegments ) * i;\r\n\t\t\t\t\tconst z = Math.sin( theta ) * radius;\r\n\r\n\t\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t\tuvArray.push(\r\n\t\t\t\t\t\tj / radSegments,\r\n\t\t\t\t\t\ti / heightSegments\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tconst normal = new Vector( Math.cos( theta ), 0, Math.sin( theta ) ).normalize();\r\n\r\n\t\t\t\t\tnormalArray.push(\r\n\t\t\t\t\t\tnormal.x,\r\n\t\t\t\t\t\tnormal.y,\r\n\t\t\t\t\t\tnormal.z\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif ( i < heightSegments ) {\r\n\r\n\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\ti * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + ( j + 1 ) % radSegments,\r\n\t\t\t\t\t\t\ti * radSegments + ( j + 1 ) % radSegments,\r\n\r\n\t\t\t\t\t\t\ti * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + ( j + 1 ) % radSegments,\r\n\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t//bottom, top\r\n\r\n\t\t\t\t\tconst side = i - heightSegments - 1;\r\n\r\n\t\t\t\t\tconst radius = side ? radiusTop : radiusBottom;\r\n\r\n\t\t\t\t\tconst x = Math.cos( theta ) * radius;\r\n\t\t\t\t\tconst y = - ( height / 2 ) + height * ( side );\r\n\t\t\t\t\tconst z = Math.sin( theta ) * radius;\r\n\r\n\t\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t\tuvArray.push(\r\n\t\t\t\t\t\t( x + radius ) * 0.5 / radius,\r\n\t\t\t\t\t\t( z + radius ) * 0.5 / radius,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tnormalArray.push( 0, - 1 + side * 2, 0 );\r\n\r\n\t\t\t\t\tconst offset = radSegments * ( heightSegments + ( side + 1 ) );\r\n\r\n\t\t\t\t\tif ( j <= radSegments - 2 ) {\r\n\r\n\t\t\t\t\t\tif ( side == 0 ) {\r\n\r\n\t\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\t\toffset, offset + j, offset + j + 1,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\t\toffset, offset + j + 1, offset + j\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// let offset = radSegments * heightSegments;\r\n\t\t// for( let i = 2; i < radSegments; i++ ){\r\n\r\n\t\t// \tindexArray.push(\r\n\t\t// \t\t0, i, i - 1,\r\n\t\t// \t\t0 + offset, i + offset, i - 1 + offset,\r\n\t\t// \t);\r\n\r\n\t\t// }\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\n\r\nexport class PlaneGeometry extends Geometry {\r\n\r\n\tconstructor( width: number = 1, height: number = 1, widthSegments: number = 1, heightSegments: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst hx = width / 2;\r\n\t\tconst hy = height / 2;\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= heightSegments; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j <= widthSegments; j ++ ) {\r\n\r\n\t\t\t\tconst x = ( j / widthSegments );\r\n\t\t\t\tconst y = ( i / widthSegments );\r\n\r\n\t\t\t\tposArray.push(\r\n\t\t\t\t\t- hx + width * x,\r\n\t\t\t\t\t- hy + height * y,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tuvArray.push( x, y );\r\n\r\n\t\t\t\tnormalArray.push( 0, 0, 1 );\r\n\r\n\t\t\t\tif ( i > 0 && j > 0 ) {\r\n\r\n\t\t\t\t\tconst n = ( widthSegments + 1 );\r\n\t\t\t\t\tconst ru = n * i + j;\r\n\t\t\t\t\tconst lb = n * ( i - 1 ) + j - 1;\r\n\r\n\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\tru, n * i + j - 1, lb,\r\n\t\t\t\t\t\tru, lb, n * ( i - 1 ) + j,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector } from '../Math/Vector';\r\n\r\nexport class SphereGeometry extends Geometry {\r\n\r\n\tconstructor( radius: number = 0.5, widthSegments: number = 20, heightSegments: number = 10 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= heightSegments; i ++ ) {\r\n\r\n\t\t\tconst thetaI = i / heightSegments * Math.PI;\r\n\r\n\t\t\tconst segments = ( i != 0 && i != heightSegments ) ? widthSegments : widthSegments;\r\n\r\n\t\t\tfor ( let j = 0; j < segments; j ++ ) {\r\n\r\n\t\t\t\t// pos\r\n\r\n\t\t\t\tconst thetaJ = j / segments * Math.PI * 2.0;\r\n\t\t\t\tconst widthRadius = Math.sin( thetaI ) * radius;\r\n\r\n\t\t\t\tconst x = Math.cos( thetaJ ) * widthRadius;\r\n\t\t\t\tconst y = - Math.cos( thetaI ) * radius;\r\n\t\t\t\tconst z = - Math.sin( thetaJ ) * widthRadius;\r\n\r\n\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t// uv\r\n\r\n\t\t\t\tuvArray.push(\r\n\t\t\t\t\tj / segments,\r\n\t\t\t\t\ti / heightSegments\r\n\t\t\t\t);\r\n\r\n\t\t\t\t//normal\r\n\r\n\t\t\t\tconst normal = new Vector( x, y, z ).normalize();\r\n\r\n\t\t\t\tnormalArray.push( normal.x, normal.y, normal.z );\r\n\r\n\t\t\t\t// index\r\n\r\n\t\t\t\tindexArray.push(\r\n\t\t\t\t\ti * widthSegments + j,\r\n\t\t\t\t\ti * widthSegments + ( j + 1 ) % widthSegments,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + ( j + 1 ) % widthSegments,\r\n\r\n\t\t\t\t\ti * widthSegments + j,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + ( j + 1 ) % widthSegments,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + j,\r\n\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n\tpublic setAttribute( name: ( 'position' | 'uv' | 'normal' | 'index' ) | ( string & {} ), array: number[], size: number ): void {\r\n\r\n\t\tif ( name == 'index' ) {\r\n\r\n\t\t\tarray.forEach( ( item, index ) => {\r\n\r\n\t\t\t\t// クソ\r\n\t\t\t\tarray[ index ] = item % this.count;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tsuper.setAttribute( name, array, size );\r\n\r\n\r\n\r\n\t}\r\n\r\n}\r\n","import { Vector } from '..';\r\nimport { Geometry } from './Geometry';\r\n\r\nexport class MipMapGeometry extends Geometry {\r\n\r\n\tconstructor( count: number = 7 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.count = count;\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tconst p = new Vector( 0, 0 );\r\n\t\tlet s = 1.0;\r\n\r\n\t\tfor ( let i = 0; i < count; i ++ ) {\r\n\r\n\t\t\tposArray.push( - 1.0 + p.x,\t\t1.0 + p.y,\t\t0 );\r\n\t\t\tposArray.push( - 1.0 + p.x + s, 1.0 + p.y,\t\t0 );\r\n\t\t\tposArray.push( - 1.0 + p.x + s, 1.0 + p.y - s,\t0 );\r\n\t\t\tposArray.push( - 1.0 + p.x,\t\t1.0 + p.y - s, \t0 );\r\n\r\n\t\t\tuvArray.push( 0.0, 1.0 );\r\n\t\t\tuvArray.push( 1.0, 1.0 );\r\n\t\t\tuvArray.push( 1.0, 0.0 );\r\n\t\t\tuvArray.push( 0.0, 0.0 );\r\n\r\n\t\t\tconst indexOffset = ( i + 0.0 ) * 4;\r\n\t\t\tindexArray.push( indexOffset + 0, indexOffset + 2, indexOffset + 1, indexOffset + 0, indexOffset + 3, indexOffset + 2 );\r\n\r\n\t\t\tp.x += s;\r\n\t\t\tp.y = p.y - s;\r\n\r\n\t\t\ts *= 0.5;\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n\r\n}\r\n","import { Component, ComponentName } from \"./Component\";\r\nimport { Entity } from \"./Entity\";\r\nimport { EntityQuery, System } from \"./System\";\r\nimport { World } from \"./World\";\r\n\r\nexport interface ECSUpdateEvent {\r\n\tworld: World,\r\n\ttime: number,\r\n\tdeltaTime: number,\r\n}\r\n\r\nexport namespace ECS {\r\n\r\n\texport const createWorld = (): World => {\r\n\r\n\t\treturn {\r\n\t\t\telapsedTime: 0,\r\n\t\t\tlastUpdateTime: new Date().getTime(),\r\n\t\t\tentitiesTotalCount: 0,\r\n\t\t\tentities: [],\r\n\t\t\tcomponents: new Map(),\r\n\t\t\tsystems: new Map()\r\n\t\t};\r\n\r\n\t};\r\n\r\n\t// entity\r\n\r\n\texport const createEntity = ( world: World ): Entity => {\r\n\r\n\t\tconst entity: Entity = world.entitiesTotalCount ++;\r\n\r\n\t\tworld.entities.push( entity );\r\n\r\n\t\treturn entity;\r\n\r\n\t};\r\n\r\n\texport const removeEntity = ( world: World, entity: Entity ): void =>{\r\n\r\n\t\tconst index = world.entities.findIndex( e => e == entity );\r\n\r\n\t\t// remove entity\r\n\r\n\t\tif ( index > - 1 ) {\r\n\r\n\t\t\tworld.entities.slice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t\t// remove components\r\n\r\n\t\tworld.components.forEach( component => {\r\n\r\n\t\t\tcomponent[ entity ] = undefined;\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t// component\r\n\r\n\texport const addComponent = <T extends Component >( world: World, entity: Entity, componentName: ComponentName, component: T ): T => {\r\n\r\n\t\tlet componentArray = world.components.get( componentName );\r\n\r\n\t\tif ( componentArray === undefined ) {\r\n\r\n\t\t\tcomponentArray = [];\r\n\r\n\t\t\tworld.components.set( componentName, componentArray );\r\n\r\n\t\t}\r\n\r\n\t\tif ( componentArray.length < entity + 1 ) {\r\n\r\n\t\t\tcomponentArray.length = entity + 1;\r\n\r\n\t\t}\r\n\r\n\t\tcomponentArray[ entity ] = component;\r\n\r\n\t\treturn component;\r\n\r\n\t};\r\n\r\n\texport const removeComponent = ( world: World, entity: Entity, componentName: ComponentName ) => {\r\n\r\n\t\tconst componentArray = world.components.get( componentName );\r\n\r\n\t\tif ( componentArray && componentArray.length > entity ) {\r\n\r\n\t\t\tcomponentArray[ entity ] = undefined;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\texport const getComponent = <T extends Component >( world: World, entity: Entity, componentName: ComponentName ): T | null => {\r\n\r\n\t\tconst component = world.components.get( componentName );\r\n\r\n\t\tif ( component !== undefined ) {\r\n\r\n\t\t\treturn ( component[ entity ] ) as T;\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t};\r\n\r\n\t// system\r\n\r\n\texport const addSystem = <T extends System >( world: World, systemName: string, system: T ) => {\r\n\r\n\t\tworld.systems.set( systemName, system );\r\n\r\n\t};\r\n\r\n\texport const removeSystem = ( world: World, componentName: ComponentName ) => {\r\n\r\n\t\tworld.systems.delete( componentName );\r\n\r\n\t};\r\n\r\n\t// update\r\n\r\n\texport const update = ( world: World ) => {\r\n\r\n\t\tconst now = new Date().getTime();\r\n\t\tconst deltaTime = ( now - world.lastUpdateTime ) / 1000;\r\n\t\tworld.elapsedTime += deltaTime;\r\n\t\tworld.lastUpdateTime = now;\r\n\r\n\t\tconst systemList = world.systems;\r\n\r\n\t\tsystemList.forEach( system => {\r\n\r\n\t\t\tsystem.update( {\r\n\t\t\t\tworld,\r\n\t\t\t\tdeltaTime,\r\n\t\t\t\ttime: world.elapsedTime,\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t};\r\n\r\n\t// entities\r\n\r\n\texport const getEntities = ( world: World, query: EntityQuery ): Entity[] => {\r\n\r\n\t\tconst entities = world.entities.filter( entt => {\r\n\r\n\t\t\tfor ( let i = 0; i < query.length; i ++ ) {\r\n\r\n\t\t\t\tconst componentName = query[ i ];\r\n\r\n\t\t\t\tconst component = world.components.get( componentName );\r\n\r\n\t\t\t\tif ( component === undefined || component[ entt ] === undefined ) {\r\n\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t} );\r\n\r\n\t\treturn entities;\r\n\r\n\t};\r\n\r\n}\r\n","\r\ntype ListenerFunction = Function;\r\n\r\ntype Listener = {\r\n\tevent: string,\r\n\tcb: ListenerFunction;\r\n\tonce?: boolean\r\n}\r\n\r\nexport class EventEmitter {\r\n\r\n\tprivate listeners: Listener[];\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.listeners = [];\r\n\r\n\t}\r\n\r\n\tpublic on( event: string, cb: ListenerFunction ) {\r\n\r\n\t\tthis.listeners.push( {\r\n\t\t\tevent,\r\n\t\t\tcb\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic once( event: string, cb: ListenerFunction ) {\r\n\r\n\t\tthis.listeners.push( {\r\n\t\t\tevent,\r\n\t\t\tcb,\r\n\t\t\tonce: true\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic off( event: string, cb: ListenerFunction ) {\r\n\r\n\t\tthis.listeners = this.listeners.filter( l => {\r\n\r\n\t\t\treturn ! ( l.event == event && l.cb == cb );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic emit( event: string, args?: any[] ) {\r\n\r\n\t\tconst tmpListener = this.listeners.concat();\r\n\r\n\t\tfor ( let i = 0; i < tmpListener.length; i ++ ) {\r\n\r\n\t\t\tconst listener = tmpListener[ i ];\r\n\r\n\t\t\tif ( listener.event == event ) {\r\n\r\n\t\t\t\tlistener.cb.apply( this, args || [] );\r\n\r\n\t\t\t\tif ( listener.once ) {\r\n\r\n\t\t\t\t\tthis.off( event, listener.cb );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { ECS, ECSUpdateEvent } from \"..\";\r\nimport { EventEmitter } from \"../../utils/EventEmitter\";\r\nimport { ComponentName } from \"../Component\";\r\nimport { Entity } from \"../Entity\";\r\n\r\nexport type EntityQuery = ComponentName[]\r\n\r\nexport interface SystemUpdateEvent extends ECSUpdateEvent {\r\n}\r\n\r\nexport class System extends EventEmitter {\r\n\r\n\tprotected queries: {name: string, query: EntityQuery}[];\r\n\r\n\tconstructor( queries?: {[key: string]:EntityQuery} ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.queries = [];\r\n\r\n\t\tif ( queries ) {\r\n\r\n\t\t\tconst keys = Object.keys( queries );\r\n\r\n\t\t\tfor ( let i = 0; i < keys.length; i ++ ) {\r\n\r\n\t\t\t\tconst name = keys[ i ];\r\n\r\n\t\t\t\tthis.queries.push( { name, query: queries[ name ] } );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\tpublic update( event: SystemUpdateEvent ): void {\r\n\r\n\t\tfor ( let i = 0; i < this.queries.length; i ++ ) {\r\n\r\n\t\t\tconst q = this.queries[ i ];\r\n\r\n\t\t\tconst entities = ECS.getEntities( event.world, q.query );\r\n\r\n\t\t\tthis.beforeUpdateImpl( q.name, event, entities );\r\n\r\n\t\t\tfor ( let j = 0; j < entities.length; j ++ ) {\r\n\r\n\t\t\t\tthis.updateImpl( q.name, entities[ j ], event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.afterUpdateImpl( q.name, event );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprotected beforeUpdateImpl( logicName: string, event: SystemUpdateEvent, entities: Entity[] ) { // eslint-disable-line\r\n\t}\r\n\r\n\tprotected updateImpl( logicName: string, entity: Entity, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n\tprotected afterUpdateImpl( logicName: string, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.emit( 'dispose' );\r\n\r\n\t}\r\n\r\n}\r\n","\n/*-------------------------------\n\t\tBezier\n-------------------------------*/\n\nexport namespace Bezier {\n\n\texport type BezierControlPoints = {\n\t\tp0: number;\n\t\tp1: number;\n\t\tp2: number;\n\t\tp3: number;\n\t}\n\n\t// inspired https://github.com/gre/bezier-easing/blob/master/src/index.js and https://github.com/0b5vr/automaton/blob/872420e798d9054d4a7a06c972cbb4261a67b4bc/src/bezierEasing.ts\n\n\texport const NEWTON_ITERATIONS = 4;\n\texport const NEWTON_MIN_SLOPE = 0.001;\n\texport const SUBDIVISION_PRECISION = 0.0000001;\n\texport const SUBDIVISION_MAX_ITERATIONS = 10;\n\texport const BEZIER_EASING_CACHE_SIZE = 11;\n\texport const BEZIER_EASING_SAMPLE_STEP_SIZE = 1.0 / BEZIER_EASING_CACHE_SIZE;\n\n\tfunction calcBezierA( p: BezierControlPoints ) {\n\n\t\treturn - p.p0 + 3.0 * p.p1 - 3.0 * p.p2 + p.p3;\n\n\t}\n\tfunction calcBezierB( p: BezierControlPoints ) {\n\n\t\treturn 3.0 * p.p0 - 6.0 * p.p1 + 3.0 * p.p2;\n\n\t}\n\tfunction calcBezierC( p: BezierControlPoints ) {\n\n\t\treturn - 3.0 * p.p0 + 3.0 * p.p1;\n\n\t}\n\n\texport function calcBezierSlope( p: BezierControlPoints, t: number ) {\n\n\t\treturn 3.0 * calcBezierA( p ) * t * t + 2.0 * calcBezierB( p ) * t + calcBezierC( p );\n\n\t}\n\n\texport function calcBezier( p: BezierControlPoints, t: number ) {\n\n\t\treturn ( ( calcBezierA( p ) * t + calcBezierB( p ) ) * t + calcBezierC( p ) ) * t + p.p0;\n\n\t}\n\n\tfunction subdiv( x: number, startT: number, endT: number, p: BezierControlPoints ) {\n\n\t\tlet currentX = 0;\n\t\tlet currentT = 0;\n\n\t\tfor ( let i = 0; i < SUBDIVISION_MAX_ITERATIONS; i ++ ) {\n\n\t\t\tcurrentT = startT + ( endT - startT ) / 2;\n\t\t\tcurrentX = calcBezier( p, currentT );\n\n\t\t\tif ( currentX > x ) {\n\n\t\t\t\tendT = currentT;\n\n\t\t\t} else {\n\n\t\t\t\tstartT = currentT;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn currentT;\n\n\t}\n\n\tfunction newton( x:number, p: BezierControlPoints, t: number ) {\n\n\t\tfor ( let i = 0; i < NEWTON_ITERATIONS; i ++ ) {\n\n\t\t\tconst slope = calcBezierSlope( p, t );\n\n\t\t\tif ( slope == 0.0 ) {\n\n\t\t\t\treturn t;\n\n\t\t\t}\n\n\t\t\tconst currentX = ( calcBezier( p, t ) ) - x;\n\t\t\tt -= currentX / slope;\n\n\t\t}\n\n\t\treturn t;\n\n\t}\n\n\texport function getBezierTfromX( p: BezierControlPoints, x: number, cache: number[] ) {\n\n\t\tp.p1 = Math.max( p.p0, Math.min( p.p3, p.p1 ) );\n\t\tp.p2 = Math.max( p.p0, Math.min( p.p3, p.p2 ) );\n\n\t\tlet sample = 0;\n\n\t\tfor ( let i = 1; i < cache.length; i ++ ) {\n\n\t\t\tsample = i - 1;\n\t\t\tif ( x < cache[ i ] ) break;\n\n\t\t}\n\n\t\tconst t = sample / ( BEZIER_EASING_CACHE_SIZE - 1.0 );\n\t\tconst diff = calcBezierSlope( p, t ) / ( p.p3 - p.p0 );\n\n\t\tif ( diff == 0.0 ) {\n\n\t\t\treturn t;\n\n\t\t} else if ( diff > 0.01 ) {\n\n\t\t\treturn newton( x, p, t );\n\n\t\t} else {\n\n\t\t\treturn subdiv( x, t, t + BEZIER_EASING_SAMPLE_STEP_SIZE, p );\n\n\t\t}\n\n\n\t}\n\n}\n","import { IVector2 } from \"..\";\nimport { Bezier } from \"./Bezier\";\n\nexport type EasingFunc = ( t: number ) => any\n\nexport namespace Easings {\n\n\texport function sigmoid( weight: number = 6 ): EasingFunc {\n\n\t\treturn ( x: number ) => {\n\n\t\t\tvar e1 = Math.exp( - weight * ( 2 * x - 1 ) );\n\t\t\tvar e2 = Math.exp( - weight );\n\n\t\t\treturn ( 1 + ( 1 - e1 ) / ( 1 + e1 ) * ( 1 + e2 ) / ( 1 - e2 ) ) / 2;\n\n\t\t};\n\n\t}\n\n\texport function smoothstep( min: number, max: number, value: number ): number {\n\n\t\tconst x = Math.max( 0, Math.min( 1, ( value - min ) / ( max - min ) ) );\n\t\treturn x * x * ( 3 - 2 * x );\n\n\t}\n\n\t/*\n\t@auther https://gist.github.com/gre/1650294\n\t*/\n\n\texport function linear( t: number ) {\n\n\t\treturn t;\n\n\t}\n\n\texport function easeInQuad( t: number ) {\n\n\t\treturn t * t;\n\n\t}\n\n\texport function easeOutQuad( t: number ) {\n\n\t\treturn t * ( 2 - t );\n\n\t}\n\n\texport function easeInOutQuad( t: number ) {\n\n\t\treturn t < .5 ? 2 * t * t : - 1 + ( 4 - 2 * t ) * t;\n\n\t}\n\n\texport function easeInCubic( t: number ) {\n\n\t\treturn t * t * t;\n\n\t}\n\n\texport function easeOutCubic( t: number ) {\n\n\t\treturn ( -- t ) * t * t + 1;\n\n\t}\n\n\texport function easeInOutCubic( t: number ) {\n\n\t\treturn t < .5 ? 4 * t * t * t : ( t - 1 ) * ( 2 * t - 2 ) * ( 2 * t - 2 ) + 1;\n\n\t}\n\n\texport function easeInQuart( t: number ) {\n\n\t\treturn t * t * t * t;\n\n\t}\n\n\texport function easeOutQuart( t: number ) {\n\n\t\treturn 1 - ( -- t ) * t * t * t;\n\n\t}\n\n\texport function easeInOutQuart( t: number ) {\n\n\t\treturn t < .5 ? 8 * t * t * t * t : 1 - 8 * ( -- t ) * t * t * t;\n\n\t}\n\n\texport function easeInQuint( t: number ) {\n\n\t\treturn t * t * t * t * t;\n\n\t}\n\n\texport function easeOutQuint( t: number ) {\n\n\t\treturn 1 + ( -- t ) * t * t * t * t;\n\n\t}\n\n  \texport function easeInOutQuint( t: number ) {\n\n  \t\treturn t < .5 ? 16 * t * t * t * t * t : 1 + 16 * ( -- t ) * t * t * t * t;\n\n  \t}\n\n\texport function bezier( c1: IVector2, h1: IVector2, h2: IVector2, c2: IVector2 ): EasingFunc {\n\n\t\tvar cache = new Array( Bezier.BEZIER_EASING_CACHE_SIZE );\n\n\t\tfor ( var i = 0; i < Bezier.BEZIER_EASING_CACHE_SIZE; ++ i ) {\n\n\t\t\tcache[ i ] = Bezier.calcBezier( { p0: c1.x, p1: h1.x, p2: h2.x, p3: c2.x }, i / ( Bezier.BEZIER_EASING_CACHE_SIZE - 1.0 ) );\n\n\t\t}\n\n\t\treturn ( x: number ) => {\n\n\t\t\tif ( x <= c1.x ) return c1.y;\n\t\t\tif ( c2.x <= x ) return c2.y;\n\n\t\t\treturn Bezier.calcBezier( { p0: c1.y, p1: h1.y, p2: h2.y, p3: c2.y }, Bezier.getBezierTfromX( { p0: c1.x, p1: h1.x, p2: h2.x, p3: c2.x }, x, cache ) );\n\n\t\t};\n\n\t}\n\n\texport function cubicBezier( h1X: number, h1Y: number, h2X: number, h2Y: number ) {\n\n\t\treturn bezier(\n\t\t\t{ x: 0.0, y: 0.0 },\n\t\t\t{ x: h1X, y: h1Y },\n\t\t\t{ x: h2X, y: h2Y },\n\t\t\t{ x: 1.0, y: 1.0 },\n\t\t);\n\n\t}\n\n}\n","import { FCurveKeyFrame } from './FCurveKeyFrame';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\n\r\nexport class FCurve extends EventEmitter {\r\n\r\n\tpublic keyframes: FCurveKeyFrame[] = [];\r\n\r\n\tprivate cache: { frame: number, value: number } = { frame: NaN, value: NaN };\r\n\r\n\tpublic frameStart: number;\r\n\tpublic frameEnd: number;\r\n\tpublic frameDuration: number;\r\n\r\n\tconstructor( frames?: FCurveKeyFrame[] ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.frameStart = 0;\r\n\t\tthis.frameEnd = 0;\r\n\t\tthis.frameDuration = 0;\r\n\r\n\t\tthis.set( frames );\r\n\r\n\t}\r\n\r\n\tpublic set( frames?: FCurveKeyFrame[] ) {\r\n\r\n\t\tif ( frames ) {\r\n\r\n\t\t\tthis.keyframes.length = 0;\r\n\r\n\t\t\tframes.forEach( keyframe => {\r\n\r\n\t\t\t\tthis.addKeyFrame( keyframe );\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic addKeyFrame( keyframe: FCurveKeyFrame ) {\r\n\r\n\t\tlet index = 0;\r\n\r\n\t\tfor ( let i = 0; i < this.keyframes.length; i ++ ) {\r\n\r\n\t\t\tconst frame = this.keyframes[ i ];\r\n\r\n\t\t\tif ( frame.coordinate.x < keyframe.coordinate.x ) {\r\n\r\n\t\t\t\tindex ++;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.keyframes.splice( index, 0, keyframe );\r\n\r\n\t\t// set frame info\r\n\r\n\t\tthis.frameStart = this.keyframes[ 0 ].coordinate.x;\r\n\t\tthis.frameEnd = this.keyframes[ this.keyframes.length - 1 ].coordinate.x;\r\n\r\n\t}\r\n\r\n\tpublic getValue( frame: number ) {\r\n\r\n\t\tif ( frame == this.cache.frame ) {\r\n\r\n\t\t\treturn this.cache.value;\r\n\r\n\t\t}\r\n\r\n\t\tlet value: number | null = null;\r\n\r\n\t\tfor ( let i = 0; i < this.keyframes.length; i ++ ) {\r\n\r\n\t\t\tconst keyframe = this.keyframes[ i ];\r\n\r\n\t\t\tif ( frame <= keyframe.coordinate.x ) {\r\n\r\n\t\t\t\tconst beforeKeyFrame = this.keyframes[ i - 1 ];\r\n\r\n\t\t\t\tif ( beforeKeyFrame ) {\r\n\r\n\t\t\t\t\tvalue = beforeKeyFrame.to( keyframe, frame );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tvalue = keyframe.coordinate.y;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( value === null && this.keyframes.length > 0 ) {\r\n\r\n\t\t\tvalue = this.keyframes[ this.keyframes.length - 1 ].coordinate.y;\r\n\r\n\t\t}\r\n\r\n\t\tif ( value !== null ) {\r\n\r\n\t\t\tthis.cache = {\r\n\t\t\t\tframe: frame,\r\n\t\t\t\tvalue: value\r\n\t\t\t};\r\n\r\n\t\t\treturn value;\r\n\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\r\n}\r\n","import { Types, Vector } from '..';\r\nimport { FCurve } from './FCurve';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\n\r\nexport class FCurveGroup extends EventEmitter {\r\n\r\n\tpublic name: string;\r\n\r\n\tprivate curves: Map<Types.RecommendString<Types.Axis>, FCurve>;\r\n\r\n\tpublic frameStart: number;\r\n\tpublic frameEnd: number;\r\n\tpublic frameDuration: number;\r\n\tprivate updatedFrame: number = - 1;\r\n\r\n\tpublic value: Vector;\r\n\r\n\tconstructor( name?: string, x?: FCurve, y?: FCurve, z?: FCurve, w?: FCurve ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.name = name || '';\r\n\r\n\t\tthis.frameStart = 0;\r\n\t\tthis.frameEnd = 0;\r\n\t\tthis.frameDuration = 0;\r\n\r\n\t\tthis.curves = new Map();\r\n\r\n\t\tthis.value = new Vector();\r\n\r\n\t\tif ( x ) this.setFCurve( x, 'x' );\r\n\t\tif ( y ) this.setFCurve( y, 'y' );\r\n\t\tif ( z ) this.setFCurve( z, 'z' );\r\n\t\tif ( w ) this.setFCurve( w, 'w' );\r\n\r\n\t}\r\n\r\n\tpublic setFCurve( curve: FCurve, axis: Types.RecommendString<Types.Axis> ) {\r\n\r\n\t\tthis.curves.set( axis, curve );\r\n\r\n\t\tlet minStart = Infinity;\r\n\t\tlet maxEnd = - Infinity;\r\n\r\n\t\tthis.curves.forEach( curve => {\r\n\r\n\t\t\tif ( curve.frameStart < minStart ) {\r\n\r\n\t\t\t\tminStart = curve.frameStart;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( curve.frameEnd > maxEnd ) {\r\n\r\n\t\t\t\tmaxEnd = curve.frameEnd;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( minStart == - Infinity || maxEnd == Infinity ) {\r\n\r\n\t\t\tminStart = 0;\r\n\t\t\tmaxEnd = 1;\r\n\r\n\t\t}\r\n\r\n\t\tthis.frameStart = minStart;\r\n\t\tthis.frameEnd = maxEnd;\r\n\t\tthis.frameDuration = this.frameEnd - this.frameStart;\r\n\r\n\t}\r\n\r\n\tpublic getFCurve( axis: Types.RecommendString<Types.Axis> ) {\r\n\r\n\t\treturn this.curves.get( axis ) || null;\r\n\r\n\t}\r\n\r\n\tpublic setFrame( frame: number ) {\r\n\r\n\t\tif ( frame == this.updatedFrame ) return this;\r\n\r\n\t\tconst x = this.curves.get( 'x' );\r\n\t\tconst y = this.curves.get( 'y' );\r\n\t\tconst z = this.curves.get( 'z' );\r\n\t\tconst w = this.curves.get( 'w' );\r\n\r\n\t\tif ( x ) this.value.x = x.getValue( frame );\r\n\t\tif ( y ) this.value.y = y.getValue( frame );\r\n\t\tif ( z ) this.value.z = z.getValue( frame );\r\n\t\tif ( w ) this.value.w = w.getValue( frame );\r\n\r\n\t\tthis.updatedFrame = frame;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n","import { IVector2 } from '../Math/Vector';\r\nimport { EasingFunc, Easings } from './Easings';\r\nimport { EventEmitter } from '../utils/EventEmitter';\r\n\r\nexport type FCurveInterpolation = \"BEZIER\" | \"LINEAR\" | \"CONSTANT\";\r\n\r\nexport class FCurveKeyFrame extends EventEmitter {\r\n\r\n\tpublic coordinate: IVector2 = { x: 0, y: 0 };\r\n\tpublic handleLeft: IVector2 = { x: 0, y: 0 };\r\n\tpublic handleRight: IVector2 = { x: 0, y: 0 };\r\n\tpublic interpolation: FCurveInterpolation = 'BEZIER';\r\n\r\n\tprivate easing: EasingFunc | null = null;\r\n\tprivate nextFrame: FCurveKeyFrame | null = null;\r\n\r\n\tconstructor( coordinate: IVector2, handleLeft?: IVector2, handleRight?: IVector2, interpolation?: FCurveInterpolation ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.set( coordinate, handleLeft, handleRight, interpolation );\r\n\r\n\t}\r\n\r\n\tpublic set( coordinate: IVector2, handleLeft?: IVector2, handleRight?: IVector2, interpolation?: FCurveInterpolation ) {\r\n\r\n\t\tthis.coordinate = coordinate;\r\n\t\tthis.handleLeft = handleLeft || coordinate;\r\n\t\tthis.handleRight = handleRight || coordinate;\r\n\t\tthis.interpolation = interpolation || 'BEZIER';\r\n\r\n\t}\r\n\r\n\tprivate getEasing( interpolation: FCurveInterpolation, nextFrame: FCurveKeyFrame ) {\r\n\r\n\t\tif ( interpolation == 'BEZIER' ) {\r\n\r\n\t\t\treturn Easings.bezier( this.coordinate, this.handleRight, nextFrame.handleLeft, nextFrame.coordinate );\r\n\r\n\t\t} else if ( interpolation == 'CONSTANT' ) {\r\n\r\n\t\t\treturn () => {\r\n\r\n\t\t\t\treturn this.coordinate.y;\r\n\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn ( t: number ) => {\r\n\r\n\t\t\t\tconst d = ( nextFrame.coordinate.y - this.coordinate.y );\r\n\t\t\t\tt = ( t - this.coordinate.x ) / ( nextFrame.coordinate.x - this.coordinate.x );\r\n\r\n\t\t\t\treturn this.coordinate.y + t * d;\r\n\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic to( nextFrame: FCurveKeyFrame, t: number ) {\r\n\r\n\t\tif ( this.nextFrame == null || this.nextFrame.coordinate.x != nextFrame.coordinate.x || this.nextFrame.coordinate.y != nextFrame.coordinate.y ) {\r\n\r\n\t\t\tthis.easing = this.getEasing( this.interpolation, nextFrame );\r\n\t\t\tthis.nextFrame = nextFrame;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.easing ) {\r\n\r\n\t\t\treturn this.easing( t );\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n","import { EventEmitter } from '../utils/EventEmitter';\r\nimport { IVector2, IVector3 } from \"../Math/Vector\";\r\nimport { FCurve } from \"../Animation/FCurve\";\r\nimport { FCurveGroup } from '../Animation/FCurveGroup';\r\nimport { FCurveInterpolation, FCurveKeyFrame } from \"../Animation/FCurveKeyFrame\";\r\n\r\n// object\r\n\r\nexport type BLidgeObject = {\r\n\tname: string,\r\n\tparent: string,\r\n\tchildren: BLidgeObject[],\r\n\tanimation: BLidgeAnimation,\r\n\tposition: IVector3,\r\n\trotation: IVector3,\r\n\tscale: IVector3,\r\n\tmaterial: BLidgeMaterialParam\r\n\ttype: BLidgeObjectType,\r\n\tparam?: BLidgeCameraParam | BLidgeMeshParam | BLidgeLightParamCommon\r\n}\r\n\r\nexport type BLidgeObjectType = 'empty' | 'cube' | 'sphere' | 'mesh' | 'camera' | 'plane' | 'light';\r\n\r\nexport type BLidgeCameraParam = {\r\n\tfov: number\r\n}\r\n\r\nexport type BLidgeMeshParam = {\r\n\tposition: number[],\r\n\tuv: number[],\r\n\tnormal: number[],\r\n\tindex: number[],\r\n}\r\n\r\nexport type BLidgeLightParam = BLidgeDirectionalLightParam | BLidgeSpotLightParam;\r\n\r\ntype BLidgeLightParamCommon = {\r\n\ttype: 'directional' | 'spot'\r\n\tcolor: IVector3,\r\n\tintensity: number,\r\n\tuseShadowMap: boolean,\r\n}\r\n\r\nexport type BLidgeDirectionalLightParam = {\r\n\ttype: 'directional'\r\n} & BLidgeLightParamCommon\r\n\r\nexport type BLidgeSpotLightParam = {\r\n\ttype: 'spot',\r\n\tangle: number,\r\n\tblend: number,\r\n} & BLidgeLightParamCommon\r\n\r\n// material\r\n\r\nexport type BLidgeMaterialParam = {\r\n\tname: string,\r\n\tuniforms: BLidgeAnimation\r\n}\r\n\r\n// scene\r\n\r\nexport type BLidgeSceneData = {\r\n    animations: {[key: string]: BLidgeAnimationCurveParam[]};\r\n\tscene: BLidgeObject;\r\n\tframe: BLidgeSceneFrame;\r\n}\r\n\r\n// animation\r\n\r\nexport type BLidgeAnimation = { [key: string]: string }\r\n\r\nexport type BLidgeAnimationCurveAxis = 'x' | 'y' | 'z' | 'w'\r\n\r\nexport type BLidgeAnimationCurveParam = {\r\n    keyframes: BLidgeAnimationCurveKeyFrameParam[];\r\n\taxis: BLidgeAnimationCurveAxis\r\n}\r\n\r\nexport type BLidgeAnimationCurveKeyFrameParam = {\r\n    c: IVector2;\r\n    h_l: IVector2;\r\n    h_r: IVector2;\r\n    e: string;\r\n    i: \"B\" | \"L\" | \"C\";\r\n}\r\n\r\n// message\r\n\r\nexport type BLidgeMessage = BLidgeSyncSceneMessage | BLidgeSyncFrameMessage\r\n\r\nexport type BLidgeSyncSceneMessage = {\r\n\ttype: \"sync/scene\",\r\n    data: BLidgeSceneData;\r\n}\r\n\r\nexport type BLidgeSyncFrameMessage = {\r\n\ttype: \"sync/timeline\";\r\n\tdata: BLidgeSceneFrame;\r\n}\r\n\r\nexport type BLidgeSceneFrame = {\r\n\tstart: number;\r\n\tend: number;\r\n\tcurrent: number;\r\n\tfps: number;\r\n\tplaying: boolean;\r\n}\r\n\r\nexport class BLidge extends EventEmitter {\r\n\r\n\t// ws\r\n\r\n\tprivate url?: string;\r\n\tprivate ws?: WebSocket;\r\n\tpublic connected: boolean = false;\r\n\r\n\t// frame\r\n\r\n\tpublic frame: BLidgeSceneFrame = {\r\n\t\tstart: - 1,\r\n\t\tend: - 1,\r\n\t\tcurrent: - 1,\r\n\t\tfps: - 1,\r\n\t\tplaying: false,\r\n\t};\r\n\r\n\t// animation\r\n\r\n\tpublic objects: BLidgeObject[] = [];\r\n\tpublic curveGroups: FCurveGroup[] = [];\r\n\tpublic scene: BLidgeObject | null;\r\n\r\n\tconstructor( url?: string ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.scene = null;\r\n\r\n\t\tif ( url ) {\r\n\r\n\t\t\tthis.url = url;\r\n\t\t\tthis.connect( this.url );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic connect( url: string ) {\r\n\r\n\t\tthis.url = url;\r\n\t\tthis.ws = new WebSocket( this.url );\r\n\t\tthis.ws.onopen = this.onOpen.bind( this );\r\n\t\tthis.ws.onmessage = this.onMessage.bind( this );\r\n\t\tthis.ws.onclose = this.onClose.bind( this );\r\n\r\n\t\tthis.ws.onerror = ( e ) => {\r\n\r\n\t\t\tconsole.error( e );\r\n\r\n\t\t\tthis.emit( 'error' );\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic loadJsonScene( jsonPath: string ) {\r\n\r\n\t\tconst req = new XMLHttpRequest();\r\n\r\n\t\treq.onreadystatechange = () => {\r\n\r\n\t\t\tif ( req.readyState == 4 ) {\r\n\r\n\t\t\t\tif ( req.status == 200 ) {\r\n\r\n\t\t\t\t\tthis.loadScene( JSON.parse( req.response ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\treq.open( 'GET', jsonPath );\r\n\t\treq.send( );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tEvents\r\n\t-------------------------------*/\r\n\r\n\tpublic loadScene( data: BLidgeSceneData ) {\r\n\r\n\t\t// frame\r\n\r\n\t\tthis.frame.start = data.frame.start;\r\n\t\tthis.frame.end = data.frame.end;\r\n\t\tthis.frame.fps = data.frame.fps;\r\n\r\n\t\tthis.curveGroups.length = 0;\r\n\t\tthis.objects.length = 0;\r\n\r\n\t\t// actions\r\n\r\n\t\tconst fcurveGroupNames = Object.keys( data.animations );\r\n\r\n\t\tfor ( let i = 0; i < fcurveGroupNames.length; i ++ ) {\r\n\r\n\t\t\tconst fcurveGroupName = fcurveGroupNames[ i ];\r\n\t\t\tconst fcurveGroup = new FCurveGroup( fcurveGroupName );\r\n\r\n\t\t\tdata.animations[ fcurveGroupName ].forEach( fcurveData => {\r\n\r\n\t\t\t\tconst curve = new FCurve();\r\n\r\n\t\t\t\tcurve.set( fcurveData.keyframes.map( frame => {\r\n\r\n\t\t\t\t\tlet interpolation = {\r\n\t\t\t\t\t\t\"B\": \"BEZIER\",\r\n\t\t\t\t\t\t\"C\": \"CONSTANT\",\r\n\t\t\t\t\t\t\"L\": \"LINEAR\",\r\n\t\t\t\t\t}[frame.i];\r\n\r\n\t\t\t\t\treturn new FCurveKeyFrame( frame.c, frame.h_l, frame.h_r, interpolation as FCurveInterpolation);\r\n\r\n\t\t\t\t} ) );\r\n\r\n\t\t\t\tfcurveGroup.setFCurve( curve, fcurveData.axis );\r\n\r\n\t\t\t} );\r\n\r\n\t\t\tthis.curveGroups.push( fcurveGroup );\r\n\r\n\t\t}\r\n\r\n\t\t// objects\r\n\r\n\t\tthis.scene = data.scene;\r\n\r\n\t\tthis.objects.length = 0;\r\n\r\n\t\tconst _ = ( obj: BLidgeObject ) => {\r\n\r\n\t\t\tthis.objects.push( obj );\r\n\r\n\t\t\tobj.children.forEach( item => _( item ) );\r\n\r\n\t\t};\r\n\r\n\t\t_( this.scene );\r\n\r\n\t\t// dispatch event\r\n\r\n\t\tthis.emit( 'sync/scene', [ this ] );\r\n\r\n\t}\r\n\r\n\tprivate onSyncTimeline( data: BLidgeSceneFrame ) {\r\n\r\n\t\tthis.frame = data;\r\n\r\n\t\tthis.emit( 'sync/timeline', [ this.frame ] );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tWS Events\r\n\t-------------------------------*/\r\n\r\n\tprivate onOpen( event: Event ) {\r\n\r\n\t\tthis.connected = true;\r\n\r\n\t}\r\n\r\n\tprivate onMessage( e: MessageEvent ) {\r\n\r\n\t\tconst msg = JSON.parse( e.data ) as BLidgeMessage;\r\n\r\n\t\tif ( msg.type == 'sync/scene' ) {\r\n\r\n\t\t\tthis.loadScene( msg.data );\r\n\r\n\t\t} else if ( msg.type == \"sync/timeline\" ) {\r\n\r\n\t\t\tthis.onSyncTimeline( msg.data );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate onClose( e:CloseEvent ) {\r\n\r\n\t\tthis.disposeWS();\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tAPI\r\n\t-------------------------------*/\r\n\r\n\tpublic getCurveGroup( name: string ) {\r\n\r\n\t\treturn this.curveGroups.find( curve => curve.name == name );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tDispose\r\n\t-------------------------------*/\r\n\r\n\tpublic dispose() {\r\n\r\n\t\tthis.disposeWS();\r\n\r\n\t}\r\n\r\n\tpublic disposeWS() {\r\n\r\n\t\tif ( this.ws ) {\r\n\r\n\t\t\tthis.ws.close();\r\n\t\t\tthis.ws.onmessage = null;\r\n\t\t\tthis.ws.onclose = null;\r\n\t\t\tthis.ws.onopen = null;\r\n\r\n\t\t\tthis.connected = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n"],"names":["GLPowerVAO","gl","program","name","buffer","size","opt","attr","count","force","attribute","indexBuffer","cb","GLPowerProgram","vertexShaderSrc","fragmentShaderSrc","vs","fs","shaderSrc","type","shader","value","uniform","i","key","id","vao","GLPowerBuffer","data","usage","target","Vector","x","y","z","w","a","_a","_b","_c","_d","v","ax","ay","az","bx","by","bz","mat","elm","e11","e12","e13","e21","e22","e23","e31","e32","e33","xx","yy","zz","e14","e24","e34","e41","e42","e43","e44","ww","GLPowerTexture","param","img","unitNumber","src","callBack","resolve","reject","GLPowerFrameBuffer","textures","t","attachment","width_size","height","Power","GLPowerTransformFeedback","varyingIndex","fbBuffer","Matrix","fov","aspect","near","far","d","width","eye","up","zAxis","xAxis","yAxis","b","c","e","f","g","h","j","k","l","m","n","o","p","q","r","s","u","A","B","det","ivd","pos","qua","scale","position","xy","xz","xw","yz","yw","zw","elm2","dist","sum","tmp","array","Quaternion","euler","order","sx","sy","sz","cx","cy","cz","Geometry","keys","core","constructor","bufferType","power","attributes","CubeGeometry","depth","hx","hy","hz","posArray","normalArray","uvArray","indexArray","offset","CylinderGeometry","radiusTop","radiusBottom","radSegments","heightSegments","theta","radius","normal","side","PlaneGeometry","widthSegments","ru","lb","SphereGeometry","thetaI","segments","thetaJ","widthRadius","item","index","MipMapGeometry","indexOffset","ECS","world","entity","component","componentName","componentArray","systemName","system","now","deltaTime","query","entt","EventEmitter","event","args","tmpListener","listener","System","queries","entities","logicName","Bezier","calcBezierA","calcBezierB","calcBezierC","calcBezierSlope","calcBezier","subdiv","startT","endT","currentX","currentT","newton","slope","getBezierTfromX","cache","sample","diff","Easings","sigmoid","weight","e1","e2","smoothstep","min","max","linear","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","bezier","c1","h1","h2","c2","cubicBezier","h1X","h1Y","h2X","h2Y","FCurve","frames","keyframe","frame","beforeKeyFrame","FCurveGroup","curve","axis","minStart","maxEnd","FCurveKeyFrame","coordinate","handleLeft","handleRight","interpolation","nextFrame","BLidge","url","jsonPath","req","fcurveGroupNames","fcurveGroupName","fcurveGroup","fcurveData","_","obj","msg"],"mappings":"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"}